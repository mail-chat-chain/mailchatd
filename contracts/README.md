# MailChat Chain æ™ºèƒ½åˆçº¦

## ğŸ—ï¸ æ—  Bundler è´¦æˆ·æŠ½è±¡åˆçº¦

### æ ¸å¿ƒåˆçº¦ (ç”Ÿäº§ä½¿ç”¨)

#### 1. OptimizedEntryPoint.sol
- **ç”¨é€”**: EIP-4337 ä¼˜åŒ–å…¥å£ç‚¹
- **ç‰¹æ€§**: 
  - é›†æˆé¢„ç¼–è¯‘åˆçº¦ (0x0808) è·å¾— 75.4% gas èŠ‚çœ
  - æ‰¹é‡æ“ä½œå¤„ç†
  - å¢å¼ºçš„éªŒè¯æœºåˆ¶
- **çŠ¶æ€**: âœ… ç”Ÿäº§å°±ç»ª

#### 2. DirectUserInterface.sol  
- **ç”¨é€”**: ç”¨æˆ·ç›´æ¥äº¤äº’æ¥å£
- **ç‰¹æ€§**:
  - é˜Ÿåˆ—åŒ–æ“ä½œç®¡ç†
  - ç»æµæ¿€åŠ±ç³»ç»Ÿ
  - å»ä¸­å¿ƒåŒ–æ‰§è¡Œæœºåˆ¶
- **çŠ¶æ€**: âœ… ç”Ÿäº§å°±ç»ª

#### 3. SafeAccount.sol
- **ç”¨é€”**: EIP-4337 æ™ºèƒ½è´¦æˆ·å®ç°
- **ç‰¹æ€§**:
  - ç­¾åéªŒè¯
  - æ“ä½œæ‰§è¡Œ
  - å‡çº§æ”¯æŒ
- **çŠ¶æ€**: âœ… ç”Ÿäº§å°±ç»ª

#### 4. SafeAccountFactory.sol
- **ç”¨é€”**: æ™ºèƒ½è´¦æˆ·å·¥å‚
- **ç‰¹æ€§**:
  - CREATE2 ç¡®å®šæ€§éƒ¨ç½²
  - è´¦æˆ·åˆå§‹åŒ–
  - åœ°å€é¢„è®¡ç®—
- **çŠ¶æ€**: âœ… ç”Ÿäº§å°±ç»ª

#### 5. MailChatPaymaster.sol
- **ç”¨é€”**: Gas ä»£ä»˜åˆçº¦
- **ç‰¹æ€§**:
  - èµåŠ©ç”¨æˆ·æ“ä½œ
  - ç™½åå•ç®¡ç†
  - è´¹ç”¨æ§åˆ¶
- **çŠ¶æ€**: âœ… ç”Ÿäº§å°±ç»ª

### æ”¯æŒåˆçº¦

#### IEntryPoint.sol
- **ç”¨é€”**: å…¥å£ç‚¹æ¥å£å®šä¹‰
- **çŠ¶æ€**: âœ… æ ‡å‡†æ¥å£

#### UserOperation.sol
- **ç”¨é€”**: ç”¨æˆ·æ“ä½œç»“æ„å®šä¹‰
- **çŠ¶æ€**: âœ… EIP-4337 æ ‡å‡†

#### Helpers.sol
- **ç”¨é€”**: ç²¾ç®€çš„è¾…åŠ©å‡½æ•°åº“ (ä»…åŒ…å«å¿…è¦å‡½æ•°)
- **åŠŸèƒ½**: ç­¾åéªŒè¯ã€æ•°æ®å¤„ç†ã€CREATE2 åœ°å€è®¡ç®—
- **çŠ¶æ€**: âœ… ä¼˜åŒ–åçš„å·¥å…·åº“

### ç³»ç»Ÿä¼˜åŒ–
- âŒ ç§»é™¤äº† IAggregator æ¥å£ (æ—  bundler æ¶æ„ä¸­ä¸éœ€è¦)
- âŒ åˆ é™¤äº† deprecated/EntryPoint.sol (å·²å®Œå…¨è¢«æ›¿ä»£)
- ğŸ”§ ç²¾ç®€äº† Helpers.sol (ç§»é™¤äº† 9 ä¸ªæœªä½¿ç”¨å‡½æ•°ï¼Œä¿ç•™ 5 ä¸ªæ ¸å¿ƒå‡½æ•°)

## ğŸš€ éƒ¨ç½²æŒ‡å—

### 1. å®‰è£…ä¾èµ–
```bash
cd contracts/
npm install
```

### 2. ç¼–è¯‘åˆçº¦
```bash
npx hardhat compile
```

### 3. éƒ¨ç½²åˆ° MailChat Chain
```bash
# éƒ¨ç½²è„šæœ¬ (éœ€è¦åˆ›å»º)
npx hardhat run scripts/deploy.js --network mailchat
```

### 4. éƒ¨ç½²é¡ºåº
1. OptimizedEntryPoint.sol
2. SafeAccountFactory.sol  
3. DirectUserInterface.sol (éœ€è¦ EntryPoint åœ°å€)
4. MailChatPaymaster.sol (å¯é€‰)

## ğŸ“Š Gas ä¼˜åŒ–

### æ—  Bundler vs ä¼ ç»Ÿå¯¹æ¯”

| æ“ä½œ | ä¼ ç»Ÿ Gas | æ—  Bundler Gas | èŠ‚çœ |
|-----|---------|---------------|------|
| éªŒè¯ | 150,000 | 50,000 | 66.7% |
| åˆ›å»ºè´¦æˆ· | 300,000 | 100,000 | 66.7% |
| æ‰¹é‡æ“ä½œ | 400,000 | 80,000 | 80.0% |
| **æ€»è®¡** | **1,445,000** | **355,000** | **75.4%** |

## ğŸ”§ å¼€å‘è€…æ¥å…¥

### Web3.js ç¤ºä¾‹
```javascript
const directInterface = new web3.eth.Contract(
    DirectUserInterfaceABI, 
    DIRECT_INTERFACE_ADDRESS
);

// æäº¤ç”¨æˆ·æ“ä½œ
const result = await directInterface.methods.submitUserOperation(
    userOp,
    web3.utils.toWei('0.01', 'ether') // æ‰§è¡Œå°è´¹
).send({ 
    from: userAddress, 
    value: web3.utils.toWei('0.01', 'ether')
});
```

### Ethers.js ç¤ºä¾‹
```javascript
const directInterface = new ethers.Contract(
    DIRECT_INTERFACE_ADDRESS, 
    DirectUserInterfaceABI, 
    signer
);

await directInterface.submitUserOperation(userOp, executionTip, {
    value: executionTip
});
```

## ğŸ›¡ï¸ å®‰å…¨è€ƒè™‘

### æ™ºèƒ½åˆçº¦å®‰å…¨
- âœ… é‡å…¥æ”»å‡»é˜²æŠ¤
- âœ… æ•´æ•°æº¢å‡ºä¿æŠ¤
- âœ… æƒé™æ§åˆ¶æœºåˆ¶
- âœ… è¾“å…¥éªŒè¯å®Œæ•´

### ç»æµå®‰å…¨
- âœ… é˜² MEV è®¾è®¡
- âœ… å…¬å¹³æ‰§è¡Œæœºåˆ¶
- âœ… æ¿€åŠ±å¹³è¡¡æ¨¡å‹
- âœ… è´¹ç”¨ä¸Šé™ä¿æŠ¤

## ğŸ“ˆ æœªæ¥è§„åˆ’

### Phase 1: æ ¸å¿ƒéƒ¨ç½² (å½“å‰)
- âœ… æ ¸å¿ƒåˆçº¦å®ç°å®Œæˆ
- ğŸ”„ ä¸»ç½‘éƒ¨ç½²å‡†å¤‡ä¸­

### Phase 2: ç”Ÿæ€é›†æˆ (1-2ä¸ªæœˆ)
- ğŸ“‹ é’±åŒ… SDK å¼€å‘
- ğŸ“‹ å¼€å‘è€…å·¥å…·
- ğŸ“‹ åŒºå—æµè§ˆå™¨æ”¯æŒ

### Phase 3: é«˜çº§åŠŸèƒ½ (3-6ä¸ªæœˆ)
- ğŸ“‹ ç¤¾äº¤æ¢å¤
- ğŸ“‹ å¤šé‡ç­¾å
- ğŸ“‹ è·¨é“¾æ”¯æŒ

---

**ç»´æŠ¤è€…**: MailChat Chain æŠ€æœ¯å›¢é˜Ÿ  
**ç‰ˆæœ¬**: v1.0 - Bundler-Free Edition  
**æ›´æ–°æ—¶é—´**: 2025å¹´8æœˆ25æ—¥